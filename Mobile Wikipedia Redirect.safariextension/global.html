<!DOCTYPE html>
<meta charset="utf-8">
<title>URL Rewrite extension</title>
<script>
	safari.application.addEventListener('beforeNavigate', setRedirect, true);
	safari.application.addEventListener('navigate', redirect, true);

	var url = "";
	var shouldRedirect = false;

	function setRedirect(event) {
		if (event.url.indexOf("https://en.wikipedia.org") == 0) {
			url = "https://en.m.wikipedia.org" + event.url.slice(24);
			shouldRedirect = true;
		} else {
			url = "";
			shouldRedirect = false;
		}
	}

	function redirect(event) {
		if (shouldRedirect) {
			event.target.url = url;
		}
	}
</script>