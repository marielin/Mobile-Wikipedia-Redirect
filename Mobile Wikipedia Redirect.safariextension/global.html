<!DOCTYPE html>
<meta charset="utf-8">
<title>URL Rewrite extension</title>
<script>
	safari.application.addEventListener('beforeNavigate', redirect, true);
	function redirect(event) {
		if (event.url.indexOf("https://en.wikipedia.org") == 0) {
			var newUrl = "https://en.m.wikipedia.org" + event.url.slice(24);

			event.preventDefault();
			event.target.url = newUrl;
		}
	}
</script>

<!-- This kind of works, but since beforeNavigate events are triggered during search bar autocomplete, this can cause strange behavior while using the search bar.  -->
<!-- <script>
	safari.application.addEventListener('beforeNavigate', redirect, true);
	function redirect(event) {
		if (event.url.indexOf("https://en.wikipedia.org") == 0) {
			var newUrl = "https://en.m.wikipedia.org" + event.url.slice(24);

			event.preventDefault();
			event.target.url = newUrl;
		}
	}
</script> -->